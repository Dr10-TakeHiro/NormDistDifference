<!DOCTYPE html>
<html>

<!-- This page uses ccchart by toshirot. Original library is available in http://github.com/toshirot/ccchart/ -->
<script src="./ccchart.js" charset="utf-8"></script>

<head>
	<meta charset="UTF-8">
	<title>2つの正規分布とその差の確立分布</title>
</head>

<body>
	<h1>2つの正規分布とその差の確立分布</h1>
	<div class="content examples">
		<div class="wrapper">
			<h2>Input</h2>
			<form oninput="draw_graph(Number(a.value), Number(b.value), Number(c.value), Number(d.value))" style="margin-bottom:4em;">
				<h3>分布1</h3>
					<math xmlns="https://www.w3.org/1998/Math/MathML/">
						<msub><mi>&mu;</mi><mn>1</mn></msub>
					</math>
						<input name="a" value="0" size="10" type="number">
					<math xmlns="https://www.w3.org/1998/Math/MathML/">
						<msub><mi>&sigma;</mi><mn>1</mn></msub>
					</math>
						<input name="b" value="1" size="10" type="number" min="1">
				<br>
				<h3>分布2</h3>
					<math xmlns="https://www.w3.org/1998/Math/MathML/">
						<msub><mi>&mu;</mi><mn>2</mn></msub>
					</math>
						<input name="c" value="0" size="10" type="number">
					<math xmlns="https://www.w3.org/1998/Math/MathML/">
						<msub><mi>&sigma;</mi><mn>2</mn></msub>
					</math>						
						<input name="d" value="1" size="10" type="number" min="1">
				</output>
			</form>
			<h2>Output</h2>
			<div id="holder"></div>
			<h3>分布1と分布2の確率分布</h2>
				<canvas id="Distribution"></canvas>
			<h3>分布2-分布1の確率分布</h2>
				<canvas id="Difference"></canvas>
		</div>
	</div>
</body>
<script type="text/javascript" id="example-code">
	function round(x, n) {
		return Math.round(x * Math.pow(10, n)) / Math.pow(10, n);
	}
	function linspace(x1, x2, n) {
		var ar = [];
		for (var i = 0; i < n; i++) {
			var num = x1 + (x2 - x1) * i / (n - 1);
			ar.push(round(num, 3));
		}
		return ar;
	}

	function normpdf(x_array, mu, sigma) {
		var ar = [];
		for (var x of x_array) {
			ar.push(
				Math.exp(
					-Math.pow(x - mu, 2) / (2 * Math.pow(sigma, 2))
				) / (
					Math.sqrt(2 * Math.PI) * sigma
				)
			);
		}
		return ar;
	}
	function wrap_area(x, y1, y2){
		if(x.length != y1.length){ return 0; }
		if(x.length != y2.length){ return 0; }
		var area = 0;
		for(var i = 0;i<x.length-1;i++){
			area = area + (x[i+1]-x[i])*Math.min(y1[i]+y1[i+1],y2[i]+y2[i+1])/2;
		}
		return area;
	}
	function positive_area(x, y){
		var area = 0;
		for(var i = 0;i<x.length-1;i++){
			if(x[i+1]+x[i]<0){continue;}
			area = area + (x[i+1]-x[i])*(y[i]+y[i+1])/2;
		}
		return round(area,2);
	}
	function draw_graph(mu1, sigma1, mu2, sigma2) {
		var x_min = Math.min(-3 * sigma1 + mu1, -3 * sigma2 + mu2);
		var x_max = Math.max(3 * sigma1 + mu1, 3 * sigma2 + mu2);
		var x = linspace(x_min, x_max, 1001);
		var y1 = normpdf(x, mu1, sigma1);
		var y2 = normpdf(x, mu2, sigma2);
		var distribution_data = {
			"config": {
				"title": "Wrap area is "+round(wrap_area(x,y1,y2)*100,0)+"%",
				"type": "area",
				"xScaleSkip": 100,
				"colorSet":["rgba(255,0,0,0.3)","rgba(0,0,255,0.3)"]
			},
			"data": [
				["value"].concat(x),
				["Distribution 1"].concat(y1),
				["Distribution 2"].concat(y2)
			]
		};
		ccchart.init("Distribution", distribution_data);

		var mu_diff = mu2 - mu1;
		var sigma_diff = Math.sqrt(sigma1*sigma1+sigma2*sigma2);
		
		var x_min = Math.min( Math.round(-3*sigma_diff+mu_diff), -Math.round(3*sigma_diff+mu_diff));
		var x_max = Math.max( -Math.round(-3*sigma_diff+mu_diff), Math.round(3*sigma_diff+mu_diff));
		var x_diff = linspace(x_min, x_max, 1001);
		var y_diff = normpdf(x_diff, mu_diff, sigma_diff);
		var diff_data = {
			"config": {
				"title": "Dist1 < Dist2 : "+positive_area(x_diff,y_diff)*100+"%",
				"type": "area",
				"xScaleSkip": 100,
				"colorSet":["rgba(255,0,255,0.3)"]
			},
			"data": [
				[""].concat(x_diff),
				[""].concat(y_diff),
			]
		};
		ccchart.init("Difference", diff_data);
	}
	draw_graph(0, 1, 0, 1);

</script>

</html>